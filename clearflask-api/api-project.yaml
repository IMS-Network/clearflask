
components:
  schemas:
    Config:
      x-clearflask-page: { name: 'Project', menuDefaultExpanded: true }
      description: Config properties visible both to client app and admins.
      type: object
      properties:
        name:
          x-clearflask-prop: { name: 'Name', description: 'Project name visible on your page' }
          type: string
        logoUrl:
          x-clearflask-prop: { name: 'Logo', description: 'Add your logo with a url', placeholder: 'https://' }
          description: Location of the logo to display.
          type: string
        pages:
          x-clearflask-page-group: { name: 'Pages', tablePropertyNames:['name', 'slug', 'title'] }
          type: array
          minItems: 1
          items:
            x-clearflask-page: { name: 'Page' }
            title: Page
            type: object
            properties:
              name:
                x-clearflask-prop: { name: 'Name', description: 'Page name shown on links and buttons pointing to this page', placeholder: 'Feature Requests' }
                type: string
              slug:
                x-clearflask-prop: { name: 'Slug', description: 'Text to display in the URL part of this page', placeholder: 'feature-requests' }
                type: string
              title:
                x-clearflask-prop: { name: 'Title', description: 'Main title visible on the tab and as first text on this page', placeholder: 'Feature Requests' }
                type: string
              description:
                x-clearflask-prop: { name: 'Description', description: 'Description of this page visible just below the title', placeholder: 'Submit your...' }
                type: string
              panels:
                x-clearflask-page-group: { name: 'Panels', tablePropertyNames:['title'] }
                type: array
                items:
                  $ref: 'api-project.yaml#/components/schemas/PagePanel'
              board:
                $ref: 'api-project.yaml#/components/schemas/PageBoard'
              explorer:
                $ref: 'api-project.yaml#/components/schemas/PageExplorer'
            required:
              - name
              - slug
        creditFormatter:
          x-clearflask-page: { name: 'Credits' }
          title: CreditFormatter
          description: >-
            Defines a format for credit.
            Entries are evaluated in order. Each entry
            matching greaterThan and lessThan value that
            matches the current value will be concatenated
            with the given separator.
          type: object
          properties:
            separator:
              type: string
            formats:
              type: array
              items:
                title: CreditFormatterEntry
                type: object
                properties:
                  greaterThan:
                    type: number
                  lessThan:
                    type: number
                  multiplier:
                    type: number
                  insignificant:
                    type: integer
                  significant:
                    type: integer
                  prefix:
                    type: string
                  suffix:
                    type: string
        ideaSettingsParent:
          $ref: 'api-project.yaml#/components/schemas/IdeaSettingsCommon'
        voteSettingsParent:
          $ref: 'api-project.yaml#/components/schemas/VoteSettingsCommon'
        ideaSettings:
          x-clearflask-page: { name: 'Ideas', menuDefaultExpanded: true }
          title: IdeaSettings
          type: object
          properties:
            statuses:
              x-clearflask-page-group: { name: 'Statuses', tablePropertyNames:['name', 'color'] }
              type: array
              items:
                x-clearflask-page: { name: 'Status' }
                title: IdeaStatus
                type: object
                properties:
                  statusId:
                    type: string
                  name:
                    type: string
                  nextStatusIds:
                    type: array
                    items:
                      title: NextStatusLink
                      type: object
                      properties:
                        nextStatusId:
                          type: string
                        transitionText:
                          type: string
                      required:
                        - nextStatusId
                  color:
                    $ref: 'api-client.yaml#/components/schemas/Color'
                  allowFunding:
                    type: boolean
                  allowVoting:
                    type: boolean
                  allowIdeaEdits:
                    type: boolean
                  allowComments:
                    type: boolean
                required:
                  - statusId
                  - name
            tags:
              x-clearflask-page-group: { name: 'Tags', tablePropertyNames:['name', 'color'] }
              type: array
              items:
                x-clearflask-page: { name: 'Tag' }
                title: IdeaTag
                type: object
                properties:
                  tagId:
                    type: string
                  name:
                    type: string
                  color:
                    $ref: 'api-client.yaml#/components/schemas/Color'
                required:
                  - tagId
                  - name
            groups:
              x-clearflask-page-group: { name: 'Groups', tablePropertyNames:['name', 'color'] }
              type: array
              items:
                x-clearflask-page: { name: 'Group' }
                title: IdeaGroup
                type: object
                properties:
                  groupId:
                    type: string
                  parentIdeaGroupId:
                    type: string
                  name:
                    type: string
                  color:
                    $ref: 'api-client.yaml#/components/schemas/Color'
                  ideaSettingsOverride:
                    $ref: 'api-project.yaml#/components/schemas/IdeaSettingsCommon'
                  voteSettingsOverride:
                    $ref: 'api-project.yaml#/components/schemas/VoteSettingsCommon'
                  defaultIdeaStatusId:
                    description: >-
                      Idea status to assign on newly created ideas.
                      If not set, project level default applies.
                    type: string
                  defaultIdeaTagIds:
                    type: array
                    items:
                      type: string
                  settableIdeaVisibility:
                    type: boolean
                  settableIdeaTagIdsOnCreate:
                    description: >-
                      In addition to project level idea tags,
                      these tags can also be added by user
                      when creating an idea.
                    type: array
                    items:
                      type: string
                required:
                  - groupId
                  - name
      required:
        - name
        - pages
        - ideaSettingsParent
        - voteSettingsParent
        - ideaGroups
        - ideaStatuses
        - supportType
    ConfigAdmin:
      description: >-
        All Config properties available for admins.
        Used for both reading and writing.
      allOf:
        - $ref: 'api-project.yaml#/components/schemas/Config'
        - type: object
          properties:
        # TODO OAuth
        # TODO Email/Push notifications
        # TODO Credit income
        # TODO Trusted public keys
    PageBoard:
      x-clearflask-page: { name: 'Board' }
      type: object
      properties:
        title:
          type: string
        panels:
          type: array
          items:
            $ref: 'api-project.yaml#/components/schemas/PagePanel'
      required:
        - panels
    PagePanel:
      x-clearflask-page: { name: 'Panel' }
      type: object
      properties:
        title:
          type: string
        hideIfEmpty:
          type: boolean
        ideaList:
          $ref: 'api-idea.yaml#/components/schemas/IdeaSearch'
        enableSearchByGroup:
          type: boolean
        enableSearchByStatus:
          type: boolean
        enableSearchByTag:
          type: boolean
      required:
        - ideaList
    PageExplorer:
      x-clearflask-page: { name: 'Explorer' }
      type: object
      properties:
        title:
          type: string
        ideaList:
          $ref: 'api-idea.yaml#/components/schemas/IdeaSearch'
      required:
        - ideaList
    VoteSettingsCommon:
      x-clearflask-page: { name: 'Voting' }
      description: >-
        Can be overriden inside IdeaGroup.
      type: object
      properties:
        allowFunding:
          type: boolean
        allowSupport:
          type: boolean
    IdeaSettingsCommon:
      x-clearflask-page: { name: 'Idea settings' }
      description: Idea settings common between project and group levels.
      type: object
      properties:
        defaultStatusId:
          description: >-
            Idea status to assign if any on newly created ideas.
            Can be overriden in group.
          type: string
        defaultIdeaTagIds:
          type: array
          items:
            type: string
        defaultIdeaVisibility:
          type: string
          enum:
            - Public
            - Private
        settableIdeaVisibility:
          type: boolean
        tagsOnCreate:
          description: >-
            These tags can be added by user when creating
            a new idea.
            Will be merged with configuration inside IdeaGroup.
          type: array
          items:
            title: TagGroupings
            type: object
            properties:
              minRequired:
                type: number
              maxRequired:
                type: number
              tagIds:
                type: array
                items:
                  type: string

/project/{projectId}/config:
  get:
    operationId: configGet
    tags: [Project]
    parameters:
      - name: projectId
        in: path
        required: true
        schema:
          type: string
    responses:
      '200':
        content:
          application/json:
            schema:
              $ref: 'api-project.yaml#/components/schemas/Config'
      '404':
        $ref: 'api-client.yaml#/components/responses/NotFound'
/project/admin:
  post:
    operationId: projectCreateAdmin
    tags: [ProjectAdmin]
    parameters:
      - name: projectId
        in: path
        required: true
        schema:
          type: string
    responses:
      '200':
        content:
          application/json:
            schema:
              title: NewProjectResult
              type: object
              properties:
                projectId:
                  type: string
                config:
                  $ref: 'api-project.yaml#/components/schemas/ConfigAdmin'
/project/{projectId}/admin/config:
  get:
    operationId: configGetAdmin
    tags: [ProjectAdmin]
    parameters:
      - name: projectId
        in: path
        required: true
        schema:
          type: string
    responses:
      '200':
        content:
          application/json:
            schema:
              $ref: 'api-project.yaml#/components/schemas/ConfigAdmin'
      '404':
        $ref: 'api-client.yaml#/components/responses/NotFound'
  put:
    operationId: configSetAdmin
    tags: [ProjectAdmin]
    parameters:
      - name: projectId
        in: path
        required: true
        schema:
          type: string
      - name: versionLast
        in: path
        required: true
        schema:
          type: string
      - name: config
        in: query
        required: true
        schema:
          $ref: 'api-project.yaml#/components/schemas/ConfigAdmin'
    responses:
      '200':
        content:
          application/json:
            schema:
              title: NewConfigResult
              type: object
              properties:
                config:
                  $ref: 'api-project.yaml#/components/schemas/ConfigAdmin'
                version:
                  type: string
              required:
                - config
                - version
      '404':
        $ref: 'api-client.yaml#/components/responses/NotFound'
