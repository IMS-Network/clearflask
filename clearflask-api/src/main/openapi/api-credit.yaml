components:
  schemas:
    Balance:
      type: object
      required:
      - balance
      properties:
        balance:
          type: number
    TransactionSearch:
      type: object
      properties:
        filterTransactionTypes:
          type: array
          items:
            $ref: 'api-credit.yaml#/components/schemas/TransactionType'
        filterAmountMin:
          type: number
        filterAmountMax:
          type: number
        filterCreatedStart:
          type: string
          format: date-time
        filterCreatedEnd:
          type: string
          format: date-time
      required:
    TransactionSearchAdmin:
      allOf:
      - $ref: 'api-credit.yaml#/components/schemas/TransactionSearch'
      - type: object
        properties:
          filterUserIds:
            type: array
            items:
              type: string
          filterTargetId:
            type: string
        required:
    Transaction:
      type: object
      properties:
        userId:
          type: string
        transactionId:
          type: string
        created:
          type: string
          format: date-time
        amount:
          type: number
        balance:
          type: number
        transactionType:
          $ref: 'api-credit.yaml#/components/schemas/TransactionType'
        targetId:
          description: >-
            Optional resource ID involved in this transaction.
            Resource type depends on the transactionType.
            Ex, for Vote type, this resource id is of the voted Idea.
            For Adjustment type, resource id is user id of the admin that
            initiated the adjustment.
          type: string
        summary:
          description: Optional user facing explanation of the transaction.
          type: string
      required:
      - userId
      - transactionId
      - created
      - amount
      - balance
      - transactionType
    TransactionCreateAdmin:
      type: object
      required:
      - amount
      properties:
        amount:
          type: number
        summary:
          description: Optional user facing explanation of the transaction.
          type: string
    TransactionType:
      type: string
      enum:
      - Vote
      - Income
      - Adjustment
      description: >-
        Transaction type
        * Vote - Balance changes due to funding an idea
        * Income - Income based on project settings.
        * Adjustment - Typically Admin initiaited change in credit.


/project/{projectId}/user/{userId}/transaction:
  get:
    operationId: transactionSearch
    tags: [Credit]
    parameters:
    - name: projectId
      in: path
      required: true
      schema:
        type: string
    - name: userId
      in: path
      required: true
      schema:
        type: string
    - name: cursor
      in: query
      schema:
        $ref: 'api-client.yaml#/components/schemas/Cursor'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: 'api-credit.yaml#/components/schemas/TransactionSearch'
    responses:
      '200':
        content:
          application/json:
            schema:
              title: TransactionSearchResponse
              type: object
              properties:
                cursor:
                  $ref: 'api-client.yaml#/components/schemas/Cursor'
                results:
                  type: array
                  items:
                    $ref: 'api-credit.yaml#/components/schemas/Transaction'
                balance:
                  $ref: 'api-credit.yaml#/components/schemas/Balance'
              required:
              - results
              - balance
/project/{projectId}/admin/user/{userId}/transaction:
  post:
    operationId: transactionCreateAdmin
    tags: [CreditAdmin]
    parameters:
    - name: projectId
      in: path
      required: true
      schema:
        type: string
    - name: userId
      in: path
      required: true
      schema:
        type: string
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: 'api-credit.yaml#/components/schemas/TransactionCreateAdmin'
    responses:
      '200':
        content:
          application/json:
            schema:
              $ref: 'api-credit.yaml#/components/schemas/Transaction'
/project/{projectId}/admin/transaction:
  get:
    operationId: transactionSearchAdmin
    tags: [CreditAdmin]
    parameters:
    - name: projectId
      in: path
      required: true
      schema:
        type: string
    - name: cursor
      in: query
      schema:
        $ref: 'api-client.yaml#/components/schemas/Cursor'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: 'api-credit.yaml#/components/schemas/TransactionSearchAdmin'
    responses:
      '200':
        content:
          application/json:
            schema:
              title: TransactionSearchAdminResponse
              type: object
              properties:
                cursor:
                  $ref: 'api-client.yaml#/components/schemas/Cursor'
                results:
                  type: array
                  items:
                    $ref: 'api-credit.yaml#/components/schemas/Transaction'
                balance:
                  $ref: 'api-credit.yaml#/components/schemas/Balance'
              required:
              - results
